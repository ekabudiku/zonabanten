<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>WebGIS Zona Multi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Mengatur dasar halaman agar tidak ada scroll yang tidak perlu */
    html, body { 
      margin: 0; 
      padding: 0; 
      height: 100%;
      font-family: Arial, sans-serif; 
    }

    #map { 
      width: 100%; 
      height: 100%; 
    }

    /* --- Panel Kontrol Utama --- */
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000; /* Pastikan di atas peta */
      background: rgba(255, 255, 255, 0.9); /* Sedikit transparan */
      padding: 10px;
      border-radius: 8px;
      max-height: calc(100vh - 40px); /* Batasi tinggi agar tidak mentok */
      overflow-y: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-size: 14px;
      display: flex;
      flex-direction: column;
      gap: 15px; /* Jarak antar elemen */
      max-width: 280px;
      transition: all 0.3s ease; /* Animasi halus */
    }
    #controls h3 { margin: 0 0 5px 0; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px;}

    label { display: flex; align-items: center; margin-bottom: 5px; cursor: pointer; }
    select { width: 100%; padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
    #zonaList { max-height: 200px; overflow-y: auto; padding-right: 5px;}
    
    /* --- Legenda --- */
    .legend {
      position: absolute;
      bottom: 20px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      line-height: 1.5;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      border: 1px solid rgba(0,0,0,0.2);
    }

    /* --- Tombol Toggle untuk Mobile --- */
    .toggle-button {
        display: none; /* Sembunyikan di desktop */
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1001; /* Di atas panel kontrol */
        background: white;
        border: none;
        padding: 8px 12px;
        font-size: 20px;
        cursor: pointer;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* --- Media Query untuk Layar Kecil (Mobile) --- */
    @media (max-width: 768px) {
      .toggle-button {
        display: block; /* Tampilkan tombol di mobile */
      }
      
      #controls {
        left: -350px; /* Sembunyikan panel ke kiri */
        width: 280px;
        height: calc(100vh - 20px);
        max-height: none;
        top: 10px;
      }

      /* Kelas 'active' untuk menampilkan panel */
      #controls.active {
        left: 10px; /* Munculkan panel */
      }
      
      .legend {
        font-size: 12px;
        bottom: 10px;
        right: 10px;
        /* Pindahkan ke atas jika ada kontrol zoom Leaflet di bawah */
        margin-bottom: 25px; 
      }
    }
  </style>
</head>
<body>

<button class="toggle-button" id="toggleButton">â˜°</button>

<div id="controls">
  <div>
    <h3>Pilih Zona Tunggal</h3>
    <select id="zonaSelect">
      <option value="">-- Tampilkan Satu Zona --</option>
    </select>
  </div>

  <div>
    <h3>Pilih Multi Zona</h3>
    <div id="zonaList"></div>
  </div>
</div>

<div id="map"></div>

<div class="legend" id="legend">
  <strong>Legenda</strong><br>
  <i style="background:#1f77b4"></i> Kode A<br>
  <i style="background:#ff7f0e"></i> Kode B<br>
  <i style="background:#2ca02c"></i> Kode C<br>
  <i style="background:#d62728"></i> Kode D<br>
  <i style="background:#999999"></i> Lainnya
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  var map = L.map('map').setView([-7.56, 110.82], 10);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  var layers = {};

  function getColorByKode(kode) {
    const colors = {
      "A": "#1f77b4", "B": "#ff7f0e", "C": "#2ca02c", "D": "#d62728"
    };
    return colors[kode] || "#999999";
  }

  function styleByKode(feature) {
    return {
      color: "#000", weight: 1, fillColor: getColorByKode(feature.properties.kode), fillOpacity: 0.6
    };
  }

  fetch("assets/files.json")
    .then(res => res.json())
    .then(files => {
      let zonaList = document.getElementById('zonaList');
      let dropdown = document.getElementById('zonaSelect');

      files.forEach((file, idx) => {
        let zonaName = "Zona " + (idx + 1);
        
        let opt = document.createElement("option");
        opt.value = file;
        opt.textContent = zonaName;
        dropdown.appendChild(opt);

        let id = "zona_" + idx;
        let label = document.createElement("label");
        let checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = file;
        checkbox.id = id;

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + zonaName));
        zonaList.appendChild(label);

        checkbox.addEventListener("change", function() {
          if (this.checked) {
            loadLayer(file);
          } else {
            removeLayer(file);
          }
        });
      });
      
      dropdown.addEventListener("change", function() {
        let file = this.value;
        Object.keys(layers).forEach(removeLayer);
        document.querySelectorAll("#zonaList input:checked").forEach(cb => cb.checked = false);
        
        if (file) {
          loadLayer(file).then(() => {
            let cb = document.querySelector(`#zonaList input[value="${file}"]`);
            if(cb) cb.checked = true;
          });
        }
      });
    });

  function loadLayer(file) {
    if (layers[file]) return; // Hindari memuat ulang jika sudah ada
    return fetch("assets/data/" + file)
      .then(res => res.json())
      .then(data => {
        layers[file] = L.geoJSON(data, {
          style: styleByKode,
          onEachFeature: (feature, layer) => {
            layer.bindPopup("Kode: " + feature.properties.kode);
          }
        }).addTo(map);
        map.fitBounds(layers[file].getBounds());
      });
  }

  function removeLayer(file) {
    if (layers[file]) {
      map.removeLayer(layers[file]);
      delete layers[file];
    }
  }

  // --- Logika untuk Tombol Toggle di Mobile ---
  const toggleButton = document.getElementById('toggleButton');
  const controlsPanel = document.getElementById('controls');

  toggleButton.addEventListener('click', () => {
    controlsPanel.classList.toggle('active');
  });

  map.on('click', () => {
    controlsPanel.classList.remove('active');
  });

</script>
</body>
</html>
